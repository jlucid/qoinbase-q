###############
Python Mapper
###############

Setup
=====
Environment setup and configuration.

Requirements
    - EmbedPy >= 1.3.1 (See :ref:`license-label`)
    - Coinbase Pro Account (See :ref:`coinbasepro-label`)

Suggested
    - kdb+ 3.6
    - Linux OS
    - Anaconda Python

.. note::
    For best results, follow suggested environment.

    Cross platform/version compatibility may require some tweaking.

    See ``environment.yml`` for dependencies.

Installation
============
Anaconda installation guide.

**Step 1** Clone or download the `repo <https://github.com/michaelsimonelli/cbproQ>`_ 

**Step 2** Create conda environment. In terminal run:

.. code:: bash

    conda env create -f environment.yml -n env_name

The conda environment will download and install all required dependencies.

.. _license-label:

License
=======
**EmbedPy requires a 64-bit kdb installation and license.**

*Conda will install automatically*

The first time you run q from this environment, you will be prompted by a standard license agreement message. 
     
Make sure to enter a valid email address because you will be asked to confirm within 72 hours or your license will expire. 

If you already have a kdb+ license associated with your email address then kdb will just use that license after you enter that email address.

The script ``resetqenv`` is provided to help reconcile multiple Q environments. (QHOME/QLIC clashes)

.. _coinbasepro-label:

Coinbase Pro
============
Integrated Q client for the `Coinbase Pro API<https://docs.pro.coinbase.com/>`_

API Support
^^^^^^^^^^^
`REST<https://docs.pro.coinbase.com/#api>`_
    - Requires authentication.
    - Provides access to order placement and account information.
    - Public client available with reduced functionality.

`WebSocket Feed<https://docs.pro.coinbase.com/#websocket-feed>`_
    - Provides market data feed.
    - No authentication required.

Environment
^^^^^^^^^^^
Live
    Production exchange

Sandbox
    The sandbox provides all of the functionality of the production exchange but allows you to add fake funds for testing.

.. warning::
    **LIVE TRADES CAN BE EXCUTED VIA THIS API.**

    Setting **CBPRO_ENV** variable to ``live`` will enable live trading. 

    **SANDBOX MODE STRONGLY RECOMMENDED**

Authentication
^^^^^^^^^^^^^^
A Coinbase Pro API key is required to execute authenticated API calls for either environment.

Login sessions and API keys are separated by environment.

Use the respective web interface to generate the corresponding environment API key.

Configuration
^^^^^^^^^^^^^
- **CBPRO_ENV** - Sets application environment (live or sandbox)
- **CBPRO_PRIV_KEY** - Auto generated by Coinbase Pro
- **CBPRO_PRIV_SECRET** - Auto generated by Coinbase Pro
- **CBPRO_PRIV_PASSPHRASE** - User generated (password)

Start
=====

**Step 1** Activate conda environment. In terminal run:

.. code:: bash

    conda activate cbpro

**Step 2** Initialize KDB.  In terminal run:

.. code:: bash

    ./startup_example

Registered application parameters are sourced via environment variables.

Reference script ``startup_example`` for example application config.